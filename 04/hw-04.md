# Домашнее задание к занятию «Продвинутые методы работы с Terraform»

## Чек-лист готовности к домашнему заданию

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image000.png)

Постараюсь избежать хардкода и передавать значения через переменные. Некоторые параметры (путь до модуля и его версию) необходимо передавать в явном виде, на то воля хашикорпа

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image001.png)

[`Итоговые файлы кода в репозитории`](https://github.com/littlelucidlynx/ter-homeworks/tree/main/04/src)

---

## Задание 1

1. Форкнул репозиторий себе, использовал его
[`Форк`](https://github.com/littlelucidlynx/yandex_compute_instance.git)

2. Виртуальные машины созданы

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image003.png)

3. Лэйблы owner и project установлены

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image004.png)

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image005.png)

4. Вывод модуля marketing-vm в консоли

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image006.png)

5. Подключение к stage-analytics-web-0 по ssh, выполнение sudo nginx -t

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image002.png)

## Задание 2

1. В output модуля выведу всю информацию, а в root модуле буду брать только нужные значения

[`Код модуля`](https://github.com/littlelucidlynx/ter-homeworks/tree/main/04/src/local_modules/vpc/)

---

Описание модуля через terraform-docs

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >=1.8.4 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_yandex"></a> [yandex](#provider\_yandex) | 0.130.0 |

## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [yandex_vpc_network.network](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/vpc_network) | resource |
| [yandex_vpc_subnet.subnet](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/vpc_subnet) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_network_name"></a> [network\_name](#input\_network\_name) | The name of the VPC network | `string` | `"n-e-t-w-o-r-k"` | no |
| <a name="input_subnet_name"></a> [subnet\_name](#input\_subnet\_name) | The name of the VPC subnet | `string` | `"s-u-b-n-e-t-w-o-r-k"` | no |
| <a name="input_v4_cidr_blocks"></a> [v4\_cidr\_blocks](#input\_v4\_cidr\_blocks) | IPv4 CIDR blocks for the subnet | `list(string)` | <pre>[<br/>  "10.0.1.0/24"<br/>]</pre> | no |
| <a name="input_zone"></a> [zone](#input\_zone) | The availability zone where the subnet will be created | `string` | `"ru-central1-a"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_out_network"></a> [out\_network](#output\_out\_network) | Network information |
| <a name="output_out_subnet"></a> [out\_subnet](#output\_out\_subnet) | Subnetwork information |

---

## Задание 3

1. Список модулей

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image007.png)

2. Удаление модулей

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image008.png)

3. Импорт модулей. Идентификаторы ресурсов взяты у провайдера. Для импорта виртуальной машины нужно импортировать только саму виртуальную машину, диск подтянулся сам

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image010.png)

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image011.png)

4. terraform plan - значимых изменений нет

![Image alt](https://github.com/littlelucidlynx/ter-homeworks/blob/main/04/Screen/Image009.png)

5. Список команд для листа ресурсов, удаления модулей, импорта модулей

```
terraform state list

terraform state rm module.vpc
terraform state rm module.analytics-vm
terraform state rm module.marketing-vm

terraform state list

terraform import module.vpc.yandex_vpc_network.network enpv07q89d1sg0rrs78l
terraform import module.vpc.yandex_vpc_subnet.subnet e9bpbkm51ngtfk9c83n7
terraform import module.analytics-vm.yandex_compute_instance.vm[0] fhm0krnt0cmhirifoe8h
terraform import module.marketing-vm.yandex_compute_instance.vm[0] fhmj0n17hgkk605is4ro

terraform state list

terraform plan

terraform apply
```